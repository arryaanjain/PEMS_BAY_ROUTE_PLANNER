# Testing Setup - Visual Summary\n\n## Your Updated Testing Pipeline\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    DATA LOADING & PREPROCESSING                       â”‚\nâ”‚  â€¢ Download PEMS Bay HDF5 data                                        â”‚\nâ”‚  â€¢ Load traffic speeds (325 sensors)                                  â”‚\nâ”‚  â€¢ Load adjacency matrix                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚               âœ¨ NEW: PHASE 1 - DATA QUALITY DIAGNOSTIC âœ¨            â”‚\nâ”‚  â€¢ Detect NaN values                                                  â”‚\nâ”‚  â€¢ Detect infinite values                                             â”‚\nâ”‚  â€¢ Check data ranges                                                  â”‚\nâ”‚  â€¢ Identify problematic sensors                                       â”‚\nâ”‚  â–º Output: Detailed diagnostic report                                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚               âœ¨ NEW: DATA FIXING - AUTOMATIC CORRECTION âœ¨           â”‚\nâ”‚  â€¢ Replace NaN with column mean                                       â”‚\nâ”‚  â€¢ Replace Inf with 0 or 1                                            â”‚\nâ”‚  â€¢ Clip out-of-range to [0, 1]                                        â”‚\nâ”‚  â–º Output: Clean normalized data                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         NORMALIZATION & SLIDING WINDOW CREATION                       â”‚\nâ”‚  â€¢ Normalize data to [0, 1] range                                     â”‚\nâ”‚  â€¢ Create sliding windows (12-step input, 12-step output)            â”‚\nâ”‚  â€¢ Split: 70% train, 10% val, 20% test                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚        âœ¨ NEW: PHASE 2 - PRE-TRAINING DATA VALIDATION âœ¨             â”‚\nâ”‚  â€¢ Validate X_train, X_val, X_test ranges                            â”‚\nâ”‚  â€¢ Check for NaN/Inf in all splits                                    â”‚\nâ”‚  â–º Output: Green light to proceed with training                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      MODEL DEFINITION                                 â”‚\nâ”‚  â€¢ Define CNN architecture                                            â”‚\nâ”‚  â€¢ Compile with Adam optimizer                                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      MODEL TRAINING                                   â”‚\nâ”‚  â€¢ Train on X_train, y_train                                          â”‚\nâ”‚  â€¢ Validate on X_val, y_val                                           â”‚\nâ”‚  â€¢ Monitor training/validation loss                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚    âœ¨ NEW: PHASE 3 - POST-TRAINING METRICS & VALIDATION âœ¨           â”‚\nâ”‚  â€¢ Training convergence analysis                                      â”‚\nâ”‚  â€¢ Generate predictions on all sets                                   â”‚\nâ”‚  â€¢ Calculate performance metrics:                                     â”‚\nâ”‚    - MSE, RMSE, MAE, MAPE, RÂ²                                         â”‚\nâ”‚    - Denormalized metrics (mph)                                       â”‚\nâ”‚  â€¢ Check prediction ranges & boundaries                               â”‚\nâ”‚  â–º Output: Comprehensive metrics report                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚    âœ¨ NEW: PHASE 4 - TEMPORAL & EDGE CASE VALIDATION âœ¨              â”‚\nâ”‚  â€¢ Check temporal smoothness (max jump < 0.15)                        â”‚\nâ”‚  â€¢ Boundary violation detection                                       â”‚\nâ”‚  â€¢ Test on extreme inputs (all 0s, all 1s)                            â”‚\nâ”‚  â–º Output: Edge case test results                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚    âœ¨ NEW: PRODUCTION READINESS CHECKLIST âœ¨                          â”‚\nâ”‚  âœ“ Data quality OK                                                    â”‚\nâ”‚  âœ“ RMSE < 5 mph                                                       â”‚\nâ”‚  âœ“ MAE < 4 mph                                                        â”‚\nâ”‚  âœ“ MAPE < 15%                                                         â”‚\nâ”‚  âœ“ RÂ² > 0.80                                                          â”‚\nâ”‚  âœ“ Predictions in [0, 1]                                              â”‚\nâ”‚  âœ“ No NaN predictions                                                 â”‚\nâ”‚  âœ“ Temporal smoothness OK                                             â”‚\nâ”‚  âœ“ No overfitting                                                     â”‚\nâ”‚  âœ“ Model converged                                                    â”‚\nâ”‚  â–º Output: READY FOR PRODUCTION âœ… or NEEDS REVIEW âš ï¸               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              MODEL EXPORT & BACKEND INTEGRATION                       â”‚\nâ”‚  â€¢ Save trained model (.keras)                                        â”‚\nâ”‚  â€¢ Save scaler (.pkl)                                                 â”‚\nâ”‚  â€¢ Integrate with FastAPI                                             â”‚\nâ”‚  â€¢ Deploy to production                                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## What Changed (âœ¨ NEW CELLS âœ¨)\n\n### Before Your Update\nâŒ No data quality checking\nâŒ Unknown if data has issues\nâŒ Training might fail silently\nâŒ No idea if model is production-ready\n\n### After Your Update\nâœ… **Diagnostic Phase**: Identifies exact data issues\nâœ… **Fixing Phase**: Automatically corrects problems  \nâœ… **Pre-Training Validation**: Ensures clean data\nâœ… **Post-Training Metrics**: Comprehensive evaluation\nâœ… **Edge Case Testing**: Robustness verification\nâœ… **Production Checklist**: Green/yellow/red signal\n\n---\n\n## New Cells Added to Your Notebook\n\n| Cell # | Name | Purpose | Input | Output |\n|--------|------|---------|-------|--------|\n| New 1 | Data Quality Diagnostic | Find issues | `data_normalized` | Report of issues |\n| New 2 | Data Fixing | Fix issues | `data_normalized` | Clean data |\n| New 3 | Pre-Training Validation | Validate splits | `X_train`, `X_val`, `X_test` | Pass/fail per split |\n| New 4 | Training Convergence | Analyze training | `history` | Loss trends |\n| New 5 | Performance Metrics | Calculate metrics | `y_true`, `y_pred` | Full metrics |\n| New 6 | Temporal Validation | Check smoothness | `y_pred` | Smoothness report |\n| New 7 | Edge Case Testing | Test extremes | Model, `X_test` | Edge case results |\n| New 8 | Production Checklist | Final verdict | All metrics | âœ…/âš ï¸/âŒ |\n\n---\n\n## Key Metrics at a Glance\n\n```\nNormalized Metrics:          Real-World Metrics:\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nMSE (0-1 scale)        â†’     RMSE (mph)\nRMSE (0-1 scale)       â†’     MAE (mph)\nRÂ² Score (0-1 scale)   â†’     MAPE (%)\nMAE (0-1 scale)                â†“\n                        What matters for users!\n                        \"My prediction is off by X mph\"\n```\n\n---\n\n## Success Criteria\n\n```\nTest RMSE < 5 mph?        âœ“ YES âœ“ â†’ Speed prediction accurate within 5 mph\n                           âœ— NO  âœ— â†’ Need better model or data\n\nTest MAE < 4 mph?         âœ“ YES âœ“ â†’ Average error less than 4 mph\n                           âœ— NO  âœ— â†’ Model needs improvement\n\nTest MAPE < 15%?          âœ“ YES âœ“ â†’ Percentage error acceptable\n                           âœ— NO  âœ— â†’ Relative errors too high\n\nTest RÂ² > 0.80?           âœ“ YES âœ“ â†’ Model explains 80%+ of variance\n                           âœ— NO  âœ— â†’ Model not capturing patterns\n\nAll 4 checks pass?        ğŸ‰ READY FOR PRODUCTION ğŸ‰\n3-4 checks pass?          âš ï¸  MOSTLY READY, review warnings\n< 3 checks pass?          âŒ NEEDS IMPROVEMENT\n```\n\n---\n\n## Common Issues & Fixes\n\n### Issue: High NaN Count\n```\nğŸ” Diagnosis:\n   - Original data has missing values\n   - Scaler not fitted on complete data\n\nâœ… Fix:\n   - Interpolate missing values before normalization\n   - Ensure scaler fits on entire dataset\n```\n\n### Issue: Many Out-of-Range Values\n```\nğŸ” Diagnosis:\n   - Data has extreme outliers\n   - Scaler range doesn't match data range\n\nâœ… Fix:\n   - Use RobustScaler instead of MinMaxScaler\n   - Clip outliers before normalization\n   - Increase scaler range\n```\n\n### Issue: High RMSE After Training\n```\nğŸ” Diagnosis:\n   - Model too simple\n   - Not enough training data\n   - Learning rate too high/low\n\nâœ… Fix:\n   - Add more CNN layers\n   - Increase training epochs\n   - Adjust learning rate\n   - Use more training data\n```\n\n---\n\n## How to Run All Tests\n\n### Option 1: Run Sequentially (Recommended)\n```\n1. Run: Data Loading Cells\n   â†“\n2. Run: Data Quality Diagnostic\n   â†“\n3. Run: Data Fixing\n   â†“\n4. Run: Pre-Training Validation\n   â†“\n5. Run: Model Training\n   â†“\n6. Run: Post-Training Metrics\n   â†“\n7. Run: Production Checklist\n```\n\n### Option 2: Quick Check\nIf you already trained a model:\n```python\n# Load model\nmodel = load_model('cnn_traffic_model.keras')\nscaler = pickle.load(open('scaler.pkl', 'rb'))\n\n# Run testing\nfrom cnn_model_testing import run_complete_testing_suite\nrun_complete_testing_suite(model, X_train, X_val, X_test, \n                          y_train, y_val, y_test, scaler)\n```\n\n---\n\n## Documentation Files\n\n| File | Purpose | Use When |\n|------|---------|----------|\n| `QUICK_FIX_OUT_OF_RANGE.md` | Quick fix for current error | You're seeing \"X data out of range\" |\n| `TESTING_SETUP_GUIDE.md` | How testing cells work | You want to understand the setup |\n| `CNN_MODEL_TESTING_GUIDE.md` | Detailed testing methodology | Deep dive needed |\n| `TESTING_CHECKLIST.md` | Quick reference checklist | During testing phase |\n| `cnn_model_testing.py` | Standalone testing module | Reusable code |\n\n---\n\n## Next Steps\n\n```\nâœ… Step 1: Run diagnostic cell\n           â†’ Understand what's wrong\n\nâœ… Step 2: Run fixing cell  \n           â†’ Automatically correct issues\n\nâœ… Step 3: Train your model\n           â†’ Use clean data\n\nâœ… Step 4: Run validation cells\n           â†’ Check performance\n\nâœ… Step 5: Check production readiness\n           â†’ Get green light âœ… or review needed âš ï¸\n\nâœ… Step 6: Export & integrate\n           â†’ Deploy to FastAPI backend\n\nâœ… Step 7: Monitor in production\n           â†’ Track performance over time\n```\n\n---\n\n**You're all set! Your model testing pipeline is now complete and comprehensive.** ğŸ‰\n
